---
title: "Talks"
echo: false
---

```{r}
#| results: asis
library(tidyverse)
library(htmltools)
library(commonmark)

talks_data <- read_csv("talks/talks.csv")

# Function to convert markdown to HTML
render_markdown <- function(text) {
  HTML(markdown_html(text))
}

# Functions to construct paths
make_slides_path <- function(name) {
  paste0("https://pingfan-hu.github.io/", name, "/")
}

make_pdf_path <- function(name) {
  paste0(file.path("/talks", name), ".pdf")
}

make_github_path <- function(name) {
  paste0("https://github.com/pingfan-hu/", name)
}

# Create presentation function
create_presentation <- function(Date, Title, Event, Location, Name, Type = "slide") {
  # Default to "slide" if Type is not provided
  presentation_type <- if(is.null(Type) || is.na(Type)) "slide" else tolower(Type)

  div(
    class = "presentation-box",
    div(
      class = "presentation-content",
      div(class = "presentation-title", Title),
      div(
        class = "presentation-details",
        div(class = "event-location", render_markdown(Event)),
        div(class = "presentation-date", format(Date, "%B %d, %Y"))
      )
    ),
    div(
      class = "presentation-icons",
      # Conditionally render either 3 round buttons or single PDF button
      if(presentation_type == "slide") {
        list(
          # Slides button
          a(
            href = make_slides_path(Name),
            class = "presentation-button round-button",
            target = "_blank",
            rel = "noopener noreferrer",
            tags$i(class = "bi bi-file-earmark-slides")
          ),
          # PDF button
          a(
            href = make_pdf_path(Name),
            class = "presentation-button round-button",
            target = "_blank",
            rel = "noopener noreferrer",
            tags$i(class = "bi bi-file-earmark-pdf")
          ),
          # GitHub repo button
          a(
            href = make_github_path(Name),
            class = "presentation-button round-button",
            target = "_blank",
            rel = "noopener noreferrer",
            tags$i(class = "bi bi-github")
          )
        )
      } else {
        # Single PDF button for Poster
        a(
          href = make_pdf_path(Name),
          class = "presentation-button round-button",
          target = "_blank",
          rel = "noopener noreferrer",
          tags$i(class = "bi bi-file-earmark-pdf")
        )
      }
    )
  )
}

# Filter and create slides
slides_data <- talks_data %>%
  filter(is.na(Type) | tolower(Type) == "slide")

slides_presentations <- slides_data %>%
  pmap(create_presentation)

# Filter and create posters
posters_data <- talks_data %>%
  filter(!is.na(Type) & tolower(Type) == "poster")

posters_presentations <- posters_data %>%
  pmap(create_presentation)
```

## Slides

```{r}
#| results: asis
div(class = "presentations-container", slides_presentations)
```

## Posters

```{r}
#| results: asis
div(class = "presentations-container", posters_presentations)
```
